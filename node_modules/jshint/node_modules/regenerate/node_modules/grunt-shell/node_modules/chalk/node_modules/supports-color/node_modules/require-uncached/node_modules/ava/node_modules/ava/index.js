'use strict';
var chalk = require('chalk');
var Runner = require('./lib/runner');
var runner = new Runner();

setImmediate(function () {
	var hadErr = false;

	runner.on('test', function (err, title) {
		if (err) {
			hadErr = true;
			console.log(chalk.red('fail'), title, err);
		}

		console.log(chalk.green('ok'), title);
	});

	runner.run(function (err) {
		process.exit(hadErr ? 1 : 0);
	});
});

module.exports = runner.addTest.bind(runner);

var fs = require('fs'),
    path = require('path'),
    asyncMap = require("slide").asyncMap,
    util = require('util');

var CovHtml = module.exports = function(cov_stats, cov_dir, cb) {
  var index = [];

  asyncMap(
    Object.keys(cov_stats),
    function(f, cb) {
      var st = cov_stats[f],
          missing_lines = st.missing.map(function(l) {
            return l.number;
          }),
          out = '<!doctype html>\n<html lang="en">\n<head>\n  ' +
                '<meta charset="utf-8">\n  <title>' +

      f + ' (' + st.loc + ')</title>\n' +
      '<style type="text/css">\n' + 
      'li {\n' +
      '  font-family: monospace;\n' +
      '  white-space: pre;\n' +
      '}\n' +
      '</style>\n' +
      '</head>\n<body>\n' +
      '<h1>' + f + ' (' + st.loc + ')' + '</h1>' +
      '<h2>Run: ' + (st.missing.length ? st.loc - st.missing.length : st.loc) + ', Missing: ' +
      st.missing.length + ', Percentage: ' + st.percentage + '</h2>' +
      '<h2>Source:</h2>\n' +
      '<ol>\n' + 
      st.lin